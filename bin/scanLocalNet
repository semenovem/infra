#!/bin/sh

ROOT=$(dirname "$(echo "$0" | grep -E "^/" -q && echo "$0" || echo "$PWD/${0#./}")")
. "${ROOT}/_core/os.sh"
. "${ROOT}/_core/logger.sh"

case "$__CORE_OS_KIND__" in
"$__CORE_OS_KIND_MACOS_CONST__")
  IP=$(ifconfig | grep "inet " | grep -Fv 127.0.0.1 | awk '{print $2}')
  ;;

"$__CORE_OS_KIND_LINUX_CONST__")
  IP=$(hostname -I | awk '{print $1}')
  ;;

esac

while true; do
  echo "$IP" | grep -iE -q '^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}.[0-9]{1,3}$' && break
  echo "enter IP address manually in format [xxx.xxx.xxx.xxx]: "
  read IP
done

NET="${IP%.*}"

echo ": start-****************************************"
echo "${NET}".{1..254} | xargs -n1 -P0 ping -c1 | grep "bytes from"
echo ": end-******************************************"
